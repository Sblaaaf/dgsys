<section class="dgsys-product-showcase-light">
  <div class="dgsys-inner">
    <!-- En-tête avec logo -->
    <header class="dgsys-header">
      <div class="dgsys-header-top">
        <img src="https://www.dgsys.fr/wp-content/uploads/2024/01/logo-dgsys-blanc-bleu.svg"
             alt="DGsys" class="dgsys-logo">
        <span class="dgsys-tagline">Solutions d'encaissement &amp; matériel connecté</span>
      </div>
      <h2>Un écosystème complet pour votre point de vente</h2>
      <p>
        Caisse tactile Aures, logiciel de caisse DGsys, monnayeur automatique,
        balances connectées et TPE : tout votre encaissement réuni dans une
        expérience fluide, rapide et sécurisée.
      </p>
    </header>

    <div class="dgsys-layout">
      <!-- HERO DYNAMIQUE (produit actif) -->
      <div class="dgsys-hero" id="dgsys-hero" data-active="caisse">
        <div class="hero-badge" id="hero-badge">PACK COMPLET DGSYS</div>

        <div class="hero-content">
          <h3 id="hero-title"></h3>
          <p class="hero-text" id="hero-text"></p>
          <div class="hero-tags" id="hero-tags"></div>
        </div>

        <div class="hero-media" id="hero-media"></div>

        <div class="hero-features" id="hero-features"></div>

        <div class="hero-cta">
          <a href="#contact" class="btn-primary">Demander une démonstration</a>
          <a href="#logiciel" class="btn-ghost">Voir le détail du logiciel</a>
        </div>
      </div>

      <!-- COLONNE DROITE : vignettes cliquables -->
      <div class="dgsys-side">
        <div class="side-grid" id="dgsys-thumbnails">
          <!-- vignettes générées en JS -->
        </div>
      </div>
    </div>
  </div>
</section>

<script>
// === Config des produits ===
const DGSYS_PRODUCTS = {
  caisse: {
    key: "caisse",
    label: "Caisse & logiciel",
    tag: "Pack complet DGsys",
    title: "Caisse tactile Aures & logiciel de caisse DGsys",
    text:
      "Une solution matérielle et logicielle conçue pour les métiers de bouche, la restauration et le commerce de détail : interface rapide, navigation intuitive, conformité fiscale et exports comptables prêts pour votre cabinet.",
    tags: [
      "Caisse tactile Aures",
      "Logiciel DGsys certifié",
      "Exports comptables intégrés"
    ],
    // HERO vidéo principale
    video:
      "https://www.dgsys.fr/wp-content/uploads/2025/11/1114_jCd6b7Ef.mp4",
    // VIGNETTE (mini carré à droite)
    thumb:
      "https://www.dgsys.fr/wp-content/uploads/2025/11/Firefly-une-video-du-produit-qui-tourne-sur-lui-meme-a-integrer-sur-mon-site-pour-une-presentation-p-1-1.mp4",
    thumbType: "video",
    features: [
      {
        title: "Interface pensée métier",
        text: "Écrans optimisés pour la boulangerie, la restauration et le commerce de détail."
      },
      {
        title: "Pilotage centralisé",
        text: "Statistiques, configuration et exports comptables depuis un même environnement."
      }
    ]
  },
  monnayeur: {
    key: "monnayeur",
    label: "Monnayeur automatique",
    tag: "Sécurisation des espèces",
    title: "Monnayeur automatique connecté à votre caisse",
    text:
      "Encaissement automatisé, rendu monnaie immédiat et hygiène renforcée : moins d’erreurs de caisse, plus de sécurité au comptoir.",
    tags: [
      "Encaissement sécurisé des espèces",
      "Rendu monnaie automatique",
      "Intégration directe à la caisse DGsys"
    ],
    video:
      "https://www.dgsys.fr/wp-content/uploads/2025/11/1114-1.mp4",
    thumb:
      "https://www.dgsys.fr/wp-content/uploads/2025/11/Firefly-une-video-du-produit-qui-tourne-sur-lui-meme-a-integrer-sur-mon-site-pour-une-presentation-p-2.mp4",
    thumbType: "video",
    features: [
      {
        title: "Sécurité & traçabilité",
        text: "Limite les écarts de caisse, réduit la manipulation d’espèces et sécurise le tiroir."
      },
      {
        title: "Flux en caisse accéléré",
        text: "Rendu monnaie automatique et files d’attente réduites en heures de pointe."
      }
    ]
  },
  balances: {
    key: "balances",
    label: "Balances connectées",
    tag: "Vente au poids",
    title: "Balances connectées pour la vente au poids",
    text:
      "Idéales pour la boulangerie, l’épicerie ou le snacking : la pesée remonte automatiquement dans la caisse DGsys pour une facturation sans erreur.",
    tags: [
      "Connexion directe à la caisse",
      "Conformité métrologique",
      "Étiquettes & affichage client"
    ],
    video: null,
    thumb: null,
    thumbType: "none",
    features: [
      {
        title: "Précision & conformité",
        text: "Balances conformes aux normes en vigueur, calibrées pour une pesée fiable."
      },
      {
        title: "Intégration caisse",
        text: "Remontée automatique du poids, du prix et du total dans votre logiciel DGsys."
      }
    ]
  },
  tpe: {
    key: "tpe",
    label: "TPE & paiement",
    tag: "Encaissement carte",
    title: "TPE & paiement sans friction",
    text:
      "Paiement carte, sans contact et mobile, avec remontée automatique des montants depuis la caisse vers le TPE pour un encaissement fluide.",
    tags: [
      "CB & sans contact",
      "Rapprochement simplifié",
      "Intégration Ingenico / Verifone…"
    ],
    video: null,
    thumb: null,
    thumbType: "none",
    features: [
      {
        title: "Expérience client fluide",
        text: "Paiement rapide, sans contact, compatible avec les nouveaux usages."
      },
      {
        title: "Caisse & banque alignées",
        text: "Montants synchronisés pour simplifier vos rapprochements bancaires."
      }
    ]
  }
};

(function () {
  const heroTitle = document.getElementById("hero-title");
  const heroText = document.getElementById("hero-text");
  const heroTags = document.getElementById("hero-tags");
  const heroMedia = document.getElementById("hero-media");
  const heroFeatures = document.getElementById("hero-features");
  const heroBadge = document.getElementById("hero-badge");
  const thumbnailsContainer = document.getElementById("dgsys-thumbnails");
  const hero = document.getElementById("dgsys-hero");

  const order = ["caisse", "monnayeur", "balances", "tpe"];
  let currentKey = "caisse";
  let autoRotate = true;
  let autoTimer = null;

  function renderHero(productKey) {
    const p = DGSYS_PRODUCTS[productKey];
    if (!p) return;

    hero.dataset.active = productKey;
    currentKey = productKey;

    heroTitle.textContent = p.title;
    heroText.textContent = p.text;

    heroBadge.textContent =
      productKey === "caisse" ? "PACK COMPLET DGSYS" : p.label.toUpperCase();

    // Tags
    heroTags.innerHTML = "";
    p.tags.forEach((tag) => {
      const span = document.createElement("span");
      span.textContent = tag;
      heroTags.appendChild(span);
    });

    // Media hero
    heroMedia.innerHTML = "";
    if (p.video) {
      const video = document.createElement("video");
      video.className = "hero-video";
      video.src = p.video;
      video.autoplay = true;
      video.muted = true;
      video.loop = true;
      video.playsInline = true;
      heroMedia.appendChild(video);
    } else {
      const placeholder = document.createElement("div");
      placeholder.style.width = "100%";
      placeholder.style.height = "260px";
      placeholder.style.display = "flex";
      placeholder.style.alignItems = "center";
      placeholder.style.justifyContent = "center";
      placeholder.style.color = "#e5e7eb";
      placeholder.style.fontSize = "1.1rem";
      placeholder.textContent = "Visuel produit DGsys";
      heroMedia.appendChild(placeholder);
    }

    // Features
    heroFeatures.innerHTML = "";
    p.features.forEach((f) => {
      const item = document.createElement("div");
      item.className = "hero-feature";
      item.innerHTML = `
        <h4>${f.title}</h4>
        <p>${f.text}</p>
      `;
      heroFeatures.appendChild(item);
    });
  }

  // vignettes à droite
  function renderThumbnails(activeKey) {
    thumbnailsContainer.innerHTML = "";

    Object.values(DGSYS_PRODUCTS).forEach((p) => {
      const card = document.createElement("article");
      card.className = "side-card";
      card.dataset.product = p.key;

      if (p.key === activeKey) {
        card.classList.add("is-active");
      }

      const shortText = p.text.split(".")[0] + ".";

      let thumbHTML = "";
      if (p.thumb && p.thumbType === "video") {
        thumbHTML = `<video src="${p.thumb}" autoplay muted loop playsinline></video>`;
      } else if (p.thumb) {
        thumbHTML = `<img src="${p.thumb}" alt="">`;
      } else {
        thumbHTML = `<div style="width:100%;height:90%;background:#111827;"></div>`;
      }

      card.innerHTML = `
        <div class="side-thumb">
          ${thumbHTML}
        </div>
        <div class="side-card-header">
          <div>
            <h4>${p.label}</h4>
            <p class="side-tag">${p.tag}</p>
          </div>
        </div>
        <p class="side-text">${shortText}</p>
      `;

      thumbnailsContainer.appendChild(card);
    });
  }

  // produit suivant pour l’auto-défilement
  function nextProduct() {
    const idx = order.indexOf(currentKey);
    const nextIdx = (idx + 1) % order.length;
    setActiveProduct(order[nextIdx]);
  }

  // stop auto après premier clic
  function stopAutoRotate() {
    if (!autoRotate) return;
    autoRotate = false;
    if (autoTimer) {
      clearInterval(autoTimer);
      autoTimer = null;
    }
  }

  // animation slide + resize
  function setActiveProduct(key) {
    if (!DGSYS_PRODUCTS[key]) return;

    hero.style.transform = "translateX(120px) scale(0.9)";
    hero.style.opacity = "0";

    setTimeout(() => {
      renderHero(key);
      renderThumbnails(key);

      hero.style.transform = "translateX(-120px) scale(0.9)";
      hero.style.opacity = "0";
      void hero.offsetWidth; // reflow

      hero.style.transform = "translateX(0) scale(1)";
      hero.style.opacity = "1";

      currentKey = key;
    }, 600);
  }

  // clic vignettes
  thumbnailsContainer.addEventListener("click", (e) => {
    const card = e.target.closest(".side-card");
    if (!card) return;
    const key = card.dataset.product;
    stopAutoRotate();
    setActiveProduct(key);
  });

  // Init : caisse
  renderHero("caisse");
  renderThumbnails("caisse");

  // auto-défilement jusqu’au premier clic
  autoTimer = setInterval(() => {
    if (!autoRotate) return;
    nextProduct();
  }, 4000);
})();
</script>
